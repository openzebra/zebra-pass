import { ZButton } from "../components/button.slint";
import { Theme } from "../theme.slint";
import { ZInput } from "../components/input.slint";
import { Routers } from "../routers.slint";
import { ZLockIcon } from "../icons/lock.slint";
import { Zlink } from "../components/link.slint";
import { KeyChainLogic, LogicResult } from "../logic.slint";

export component LockPage inherits Window {
    private property <LogicResult> result :  {
        success: false,
        error: ""
    };
    private property <string> password_value;

    callback continue(Routers);

    HorizontalLayout {
        VerticalLayout {
            height: Theme.app-height;
            Image {
                source: @image-url("../images/zebra_print.png");
                colorize: Theme.window-background-inverse;
                height: 100%;
                width: Theme.zerba-print-length;
                image-fit: fill;
            }
        }
        VerticalLayout {
            width: Theme.app-width - Theme.zerba-print-length;
            alignment: center;
            HorizontalLayout {
                width: 100%;
                alignment: center;
                VerticalLayout {
                    alignment: center;
                    spacing: 5pt;
                    ZLockIcon {
                        height: 40pt;
                        fill: Theme.window-background-inverse;
                    }
                    ZInput {
                        height: 46pt;
                        width: 220pt;
                        alignment: center;
                        placeholder: @tr("Password");
                        type: password;
                        label-color: Theme.window-background-inverse.darker(50%);
                        value <=> password_value;
                    }
                    HorizontalLayout {
                        height: 15pt;
                        Text {
                            horizontal-alignment: center;
                            color: Theme.danger;
                            text: result.error;
                        }
                    }
                    ZButton {
                        height: 36pt;
                        width: 220pt;
                        color: Theme.window-background;
                        background: Theme.window-background-inverse;
                        text: @tr("Unlock");
                        clicked => {
                            result = KeyChainLogic.request-unlock(password_value);
                            if (result.success) {
                                continue(Routers.Home);
                            }
                        }
                    }
                    HorizontalLayout {
                        alignment: center;
                        VerticalLayout {
                            padding-right: 2pt;
                            alignment: center;
                            Rectangle {
                                width: 100pt;
                                height: 1pt;
                                background: Theme.window-background-inverse.transparentize(50%);
                            }
                        }
                        Text {
                            text: @tr("Or");
                            color: Theme.window-background-inverse.transparentize(50%);
                        }
                        VerticalLayout {
                            alignment: center;
                            padding-left: 2pt;
                            Rectangle {
                                width: 100pt;
                                height: 1pt;
                                background: Theme.window-background-inverse.transparentize(50%);
                            }
                        }
                    }
                    HorizontalLayout {
                        alignment: center;
                        Zlink {
                            color: Theme.secondary;
                            text: @tr("Restore");
                            clicked => {
                                continue(Routers.Mnemonic);
                            }
                        }
                    }
                }
            }
        }
    }

    states [
        
    ]
}
